package com.huawei.systemmanager.antimal.ui;

import android.app.Notification.Builder;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import com.huawei.permissionmanager.utils.ShareCfg;
import com.huawei.systemmanager.R;
import com.huawei.systemmanager.antimal.AntiMalBroadcastReceiver;
import com.huawei.systemmanager.antimal.MalwareConst;
import com.huawei.systemmanager.util.NotificationID;

public class AntimalwareNotification {
    private static final String ACTION_USER_CLICK_GUIDE_NOTIFICATION = "com.huawei.systemmanager.ACTION.userclickguide";
    private static final String TAG = "AntimalwareNotification";
    private Context mContext;
    private int mNum;
    private String mPkg;

    public AntimalwareNotification(Context context, int num, String pkg) {
        this.mContext = context;
        this.mNum = num;
        this.mPkg = pkg;
    }

    public void showNotification(Bundle bundle) {
        String contentTitle;
        Intent notificationIntent = new Intent(this.mContext, MalwareAppListActivity.class);
        notificationIntent.setAction(ACTION_USER_CLICK_GUIDE_NOTIFICATION);
        notificationIntent.setPackage(this.mContext.getPackageName());
        notificationIntent.putExtras(bundle);
        if (this.mNum == 1) {
            contentTitle = String.format(this.mContext.getString(R.string.anti_malware_notification_title_one), new Object[]{this.mPkg});
        } else {
            contentTitle = this.mContext.getResources().getQuantityString(R.plurals.anti_malware_notification_title_few, this.mNum, new Object[]{this.mPkg, Integer.valueOf(this.mNum)});
        }
        String contentText = (String) this.mContext.getText(R.string.anti_malware_notification_content);
        String leftText = this.mContext.getString(R.string.goto_uninstall);
        String rightText = this.mContext.getString(R.string.cancel);
        notificationMgr(this.mContext).notify(NotificationID.ANTI_MALW, getSameBuilder(this.mContext, contentTitle, contentText, PendingIntent.getActivity(this.mContext, 0, notificationIntent, 134217728), leftText, rightText, getCancelIntent(this.mContext, NotificationID.ANTI_MALW)).build());
    }

    public void showRestoreNotification(Context ctx) {
        PendingIntent contentIntent = getDeleteIntent(ctx);
        PendingIntent rightIntent = getCancelIntent(ctx, NotificationID.ANTI_MALW_RESTORE);
        notificationMgr(ctx).notify(NotificationID.ANTI_MALW_RESTORE, getSameBuilder(ctx, ctx.getResources().getString(R.string.anti_malware_notification_restore), null, contentIntent, ctx.getResources().getString(R.string.anti_malware_use), ctx.getResources().getString(R.string.cancel), rightIntent).build());
    }

    private PendingIntent getDeleteIntent(Context ctx) {
        Intent intent = new Intent(ctx, AntiMalBroadcastReceiver.class);
        intent.setAction(MalwareConst.ANTIMAL_RESTORE_LAUNCHER);
        return PendingIntent.getBroadcast(ctx, 0, intent, ShareCfg.PERMISSION_MODIFY_CALENDAR);
    }

    private PendingIntent getCancelIntent(Context ctx, int type) {
        Intent intent = new Intent(ctx, AntiMalBroadcastReceiver.class);
        intent.putExtra(MalwareConst.ANTIMAL_NOTIFICATION_TYPE, type);
        intent.setAction(MalwareConst.ANTIMAL_CANCLE_NOTIFICATION);
        return PendingIntent.getBroadcast(ctx, 1, intent, ShareCfg.PERMISSION_MODIFY_CALENDAR);
    }

    private Builder getSameBuilder(Context ctx, String title, String text, PendingIntent pt, String leftText, String rightText, PendingIntent ct) {
        return new Builder(ctx).setContentTitle(title).setContentText(text).setContentIntent(pt).setDefaults(2).setPriority(2).setWhen(System.currentTimeMillis()).setSmallIcon(R.drawable.ic_launcher).setAutoCancel(true).setOngoing(true).addAction(0, leftText, pt).addAction(0, rightText, ct);
    }

    private NotificationManager notificationMgr(Context ctx) {
        return (NotificationManager) ctx.getSystemService("notification");
    }

    public void destroyNotification(Context ctx, int id) {
        notificationMgr(ctx).cancel(id);
    }
}
